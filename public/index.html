<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>OpenLearn</title>
  <link rel="stylesheet" href="./styles.css?v=final-1" />
</head>
<body class="with-topbar anon">

  <!-- ===== Topbar ===== -->
  <header id="topbar">
    <div class="topbar-row">
      <button id="btn-burger" aria-label="Menu">â˜°</button>
      <div class="logo">OpenLearn</div>

      <div id="topSearchWrap">
        <input id="topSearch" class="input" placeholder="Search courses..." />
        <button class="search-ico" id="topSearchIcon" aria-label="Search">ğŸ”</button>
      </div>

      <div class="top-right">
        <!-- Announcements -->
        <button id="btn-top-ann" class="icon-pill pill-ann">
          ğŸ”” <span class="txt">Announcements</span>
        </button>

        <!-- Live Chat -->
        <button id="btn-top-chat" class="icon-pill pill-chat" data-requires-auth>
          ğŸ’¬ <span class="txt">Live Chat</span>
          <span id="chatCount" class="badge" style="display:none"></span>
        </button>

        <!-- Auth -->
        <button id="btn-login" class="btn">Login</button>
        <button id="btn-logout" class="btn" style="display:none">Logout</button>
      </div>
    </div>
  </header>

  <!-- ===== Sidebar ===== -->
  <aside id="sidebar">
    <nav>
      <button class="navbtn active" data-page="catalog"><i>ğŸ </i><span>Catalog</span></button>
      <button class="navbtn" data-page="mylearning"><i>ğŸ’</i><span>My Learning</span></button>
      <button class="navbtn" data-page="gradebook"><i>ğŸ“Š</i><span>Gradebook</span></button>
      <button class="navbtn" data-page="dashboard"><i>ğŸ“°</i><span>Dashboard</span></button>
      <button class="navbtn" id="btn-side-chat" data-page="livechat"><i>ğŸ’¬</i><span>Live Chat</span></button>
      <button class="navbtn" data-page="admin" data-requires-auth><i>ğŸ› </i><span>Admin</span></button>
    </nav>
  </aside>

  <!-- ===== Main ===== -->
  <main id="main">
    <!-- Catalog -->
    <section id="page-catalog" class="page visible">
      <div class="row" style="justify-content: space-between; margin-bottom: 8px;">
        <div class="filters-wrap">
          <select id="filterCategory" class="input"></select>
          <select id="filterLevel" class="input">
            <option value="">All Levels</option>
            <option>Beginner</option>
            <option>Intermediate</option>
            <option>Advanced</option>
          </select>
          <select id="sortBy" class="input">
            <option value="">Sort: Default</option>
            <option value="title-asc">Title Aâ†’Z</option>
            <option value="title-desc">Title Zâ†’A</option>
            <option value="price-asc">Price Lowâ†’High</option>
            <option value="price-desc">Price Highâ†’Low</option>
          </select>
        </div>

        <div class="row">
          <button id="btn-new-course" class="btn" data-requires-auth>New Course</button>
        </div>
      </div>

      <div id="courseGrid" class="grid"></div>
    </section>

    <!-- My Learning -->
    <section id="page-mylearning" class="page">
      <h2 class="h4">My Learning</h2>
      <div id="myLearningGrid" class="grid"></div>
    </section>

    <!-- Gradebook -->
    <section id="page-gradebook" class="page">
      <h2 class="h4">Gradebook</h2>
      <div id="gradeTableWrap" class="table-responsive">
        <table class="ol-table" id="gradeTable">
          <thead><tr><th>Course</th><th>Best Score</th><th>Status</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Dashboard (Announcements list lives here) -->
    <section id="page-dashboard" class="page">
      <h2 class="h4">Announcements</h2>
      <div id="annList" class="stack"></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px;">
        <button id="btn-new-post" class="btn" data-requires-auth>New Announcement</button>
      </div>
    </section>

    <!-- ===== Live Chat Page ===== -->
<section id="page-livechat" class="page">
  <div class="card" style="max-width: 900px; margin: 0 auto;">
    <div class="row" style="justify-content: space-between;">
      <h2 class="h4">Live Chat</h2>
      <div class="muted small" id="chatRoomLabel">room: global</div>
    </div>

    <div id="chatBox"
         style="height: 360px; overflow-y:auto; margin: 10px 0; padding:12px; border:1px solid var(--border); border-radius: 12px; background: var(--card);">
      <!-- messages will render here -->
    </div>

    <div class="row">
      <input id="chatInput" class="input" placeholder="Type a messageâ€¦" style="flex:1;"/>
      <button id="chatSend" class="btn primary">Send</button>
    </div>
  </div>
</section>

    <!-- Admin -->
    <section id="page-admin" class="page">
      <h2 class="h4">Admin</h2>
      <div id="adminTable" class="stack"></div>
    </section>
  </main>

  <!-- ===== Dialogs ===== -->

  <!-- Auth (injected if missing by JS) -->

  <!-- Course Modal -->
  <dialog id="courseModal" class="ol-modal card">
    <div class="row" style="justify-content: space-between; align-items:center; margin-bottom: 6px;">
      <b class="modal-title">New Course</b>
      <button class="btn small" id="btn-course-close" type="button">Close</button>
    </div>
    <form id="courseForm" class="authpane">
      <label>Title <input id="cTitle" class="input" required /></label>
      <label>Category <input id="cCat" class="input" required /></label>
      <label>Level
        <select id="cLvl" class="input" required>
          <option>Beginner</option><option>Intermediate</option><option>Advanced</option>
        </select>
      </label>
      <label>Price (USD) <input id="cPrice" type="number" class="input" value="0"/></label>
      <label style="grid-column:1/-1">Summary
        <textarea id="cSummary" class="input" rows="4"></textarea>
      </label>
      <div class="row" style="justify-content:flex-end; gap:8px;">
        <button class="btn" id="btn-course-cancel" type="button">Cancel</button>
        <button class="btn primary" id="btn-course-save" type="submit">Save</button>
      </div>
    </form>
  </dialog>

  <!-- Details Modal -->
  <dialog id="detailsModal" class="ol-modal card">
    <div class="row" style="justify-content: space-between; align-items:center; margin-bottom: 6px;">
      <b class="modal-title">Course Details</b>
      <button class="btn small" id="btn-details-close" type="button">Close</button>
    </div>
    <div class="modal-body">
      <div id="detailsInner">Loadingâ€¦</div>
    </div>
    <div class="row" style="justify-content:flex-end; gap:8px; margin-top:10px;">
      <button class="btn" id="btn-details-cancel" type="button">Close</button>
    </div>
  </dialog>

  <!-- Announcements: New/Edit -->
  <dialog id="postModal" class="ol-modal card">
    <div class="row" style="justify-content: space-between; align-items:center; margin-bottom:6px;">
      <b class="modal-title">New Announcement</b>
      <button class="btn small" id="closePostModal" type="button">Close</button>
    </div>
    <form id="postForm" class="authpane">
      <label>Title <input id="pmTitle" class="input" required /></label>
      <label style="grid-column:1/-1">Body
        <textarea id="pmBody" class="input" rows="6" required></textarea>
      </label>
      <div class="row" style="justify-content:flex-end; gap:8px;">
        <button class="btn" id="cancelPost" type="button">Cancel</button>
        <button class="btn primary" id="savePost" type="submit">Post</button>
      </div>
    </form>
  </dialog>

  <!-- Pay Modal -->
  <dialog id="payModal" class="ol-modal card">
    <div class="row" style="justify-content: space-between; align-items:center; margin-bottom:6px;">
      <b class="modal-title">Checkout</b>
      <button id="closePay" class="btn small" type="button">Close</button>
    </div>
    <div id="paypal-container" style="min-height: 50px;"></div>
    <div class="row" style="justify-content:flex-end; gap:8px; margin-top:10px;">
      <button id="mmkPaid" class="btn primary" type="button">Mark as Paid (MMK)</button>
    </div>
  </dialog>

  <!-- Certificate Modal (your existing cert UI/styles) -->
  <dialog id="certModal" class="ol-modal">
    <div id="certBody">
      <!-- cert content inserted by JS -->
    </div>
    <div class="row no-print" style="justify-content:flex-end; gap:8px; margin-top:10px">
      <button id="certPrint" class="btn">Print</button>
      <button id="certClose" class="btn">Close</button>
    </div>
  </dialog>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- App -->
  <script type="module" src="./app.js?v=final-1"></script>
</body>
</html>