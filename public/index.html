<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OpenLearn</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icons/icon-192.png">
  <link rel="stylesheet" href="/styles.css">
  <!-- Chart.js for Analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF for Certificates/Transcripts -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- PayPal SDK (replace YOUR_CLIENT_ID) -->
  <script src="https://www.paypal.com/sdk/js?client-id=AVpfmQ8DyyatFaAGQ3Jg58XtUt_2cJDr1leqcc_JI8LvKIR2N5WB_yljqCOTTCtvK1hFJ7Q9X0ojXsEC&currency=USD" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <img src="/icons/icon-192.png" alt="">
    <span>OpenLearn</span>
  </div>
  <div class="search">
    <input id="topSearch" type="search" placeholder="Search courses…">
    <button id="topSearchBtn" class="btn">Search</button>
  </div>
  <div class="right">
    <a id="btnLogin" class="btn" href="/login.html">Login</a>
    <button id="btnLogout" class="btn" style="display:none">Logout</button>
  </div>
</header>

<aside id="sidebar" class="sidebar">
  <nav class="nav">
    <button class="navbtn" data-goto="catalog"><span class="ico">📚</span><span>Courses</span></button>
    <button class="navbtn" data-goto="mylearning"><span class="ico">🎒</span><span>My Learning</span></button>
    <button class="navbtn" data-goto="gradebook"><span class="ico">📊</span><span>Gradebook</span></button>
    <button class="navbtn" data-goto="dashboard" id="navDash"><span class="ico">📰</span><span>Dashboard</span></button>
    <button class="navbtn" data-goto="analytics" id="navAnalytics"><span class="ico">📈</span><span>Analytics</span></button>
    <button class="navbtn" data-goto="settings"><span class="ico">⚙️</span><span>Settings</span></button>
  </nav>
</aside>

<main class="content">
  <!-- Catalog -->
  <section id="page-catalog">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div class="h2">Courses</div>
      <button id="btnNewCourse" class="btn" style="display:none">+ New Course</button>
    </div>
    <div class="grid" id="courseGrid"></div>
  </section>

  <!-- My Learning -->
  <section id="page-mylearning" style="display:none">
    <div class="h2">My Learning</div>
    <div class="grid" id="myGrid"></div>

    <article id="reader" class="reader" style="display:none">
      <div class="h3" id="rdTitle"></div>
      <div class="progress"><i id="rdProg" style="width:0%"></i></div>
      <div id="rdBody"></div>
      <div style="display:flex;justify-content:space-between;margin-top:10px">
        <button id="rdPrev" class="btn">Prev</button>
        <div class="small" id="rdInfo">1/1</div>
        <button id="rdNext" class="btn">Next</button>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="rdBookmark" class="btn">🔖 Bookmark</button>
        <button id="rdNote" class="btn">📝 Note</button>
        <button id="btnCertificate" class="btn">📄 Certificate (PDF)</button>
        <button id="btnTranscript" class="btn">🧾 Transcript (PDF)</button>
      </div>
    </article>
  </section>

  <!-- Gradebook -->
  <section id="page-gradebook" style="display:none">
    <div class="h2">Gradebook</div>
    <table class="table">
      <thead><tr><th>Course</th><th>Score</th><th>Credits</th><th>Progress</th></tr></thead>
      <tbody id="gbTbody"></tbody>
    </table>
  </section>

  <!-- Student Dashboard (Chat + Announcements) -->
  <section id="page-dashboard" style="display:none">
    <div class="h2">Student Dashboard</div>
    <div class="grid">
      <div class="card"><div class="body">
        <div class="h3">Live Chat</div>
        <div id="chatBox" style="height:240px;overflow:auto;border:1px solid var(--border);border-radius:10px;padding:10px"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="chatInput" class="btn" style="flex:1" placeholder="Type a message…">
          <button id="chatSend" class="btn primary">Send</button>
        </div>
      </div></div>

      <div class="card"><div class="body">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="h3">Announcements</div>
          <button id="annNew" class="btn" style="display:none">+ New</button>
        </div>
        <div id="annList"></div>
      </div></div>
    </div>
  </section>

  <!-- Analytics -->
  <section id="page-analytics" style="display:none">
    <div class="h2">Analytics</div>
    <div class="grid">
      <div class="card"><div class="body"><canvas id="chartEnrolls"></canvas></div></div>
      <div class="card"><div class="body"><canvas id="chartByCat"></canvas></div></div>
    </div>
  </section>

  <!-- Settings -->
  <section id="page-settings" style="display:none">
    <div class="h2">Settings</div>
    <div class="card"><div class="body" style="display:flex;gap:12px;flex-wrap:wrap">
      <label>Theme
        <select id="themeSel" class="btn">
          <option value="dark">Dark</option>
          <option value="light">Light</option>
          <option value="ocean">Ocean</option>
          <option value="violet">Violet</option>
        </select>
      </label>
      <label>Font
        <select id="fontSel" class="btn">
          <option>14</option><option selected>16</option><option>18</option><option>20</option>
        </select>
      </label>
    </div></div>
  </section>
</main>

<footer class="footer">
  <a href="#" data-open-static="contact" class="btn ghost" data-guest-lock>Contact</a>
  <a href="#" data-open-static="guide"   class="btn ghost" data-guest-lock>Guide</a>
  <a href="#" data-open-static="privacy" class="btn ghost" data-guest-lock>Privacy</a>
  <a href="#" data-open-static="policy"  class="btn ghost" data-guest-lock>Policy</a>
  <span class="grow"></span>
  <!-- social icons also lock for guests -->
  <a class="soc" href="https://youtube.com"   target="_blank" data-guest-lock>▶</a>
  <a class="soc" href="https://tiktok.com"    target="_blank" data-guest-lock>♫</a>
  <a class="soc" href="https://facebook.com"  target="_blank" data-guest-lock>f</a>
  <a class="soc" href="https://instagram.com" target="_blank" data-guest-lock>◎</a>
  <a class="soc" href="https://twitter.com"   target="_blank" data-guest-lock>X</a>
</footer>

<!-- Static dialog -->
<dialog id="dlgStatic"><div class="wrap">
  <h3 id="stTitle" class="h3">Info</h3>
  <div id="stBody"></div>
  <menu style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
    <button class="btn" onclick="this.closest('dialog').close()">Close</button>
  </menu>
</div></dialog>

<!-- New Course dialog -->
<dialog id="dlgCourse"><div class="wrap">
  <form method="dialog" id="newCourseForm">
    <h3 class="h3">Create New Course</h3>
    <label>Title <input id="ncTitle" class="btn" required></label>
    <label>Category <input id="ncCategory" class="btn"></label>
    <label>Level <select id="ncLevel" class="btn"><option>Beginner</option><option>Intermediate</option><option>Advanced</option></select></label>
    <label>Rating <input id="ncRating" class="btn" type="number" min="0" max="5" step="0.1" value="4.5"></label>
    <label>Hours <input id="ncHours" class="btn" type="number" min="1" value="8"></label>
    <label>Price <input id="ncPrice" class="btn" type="number" min="0" value="0"></label>
    <label>Credits <input id="ncCredits" class="btn" type="number" min="0" value="3"></label>
    <label>Image URL <input id="ncThumb" class="btn" placeholder="/images/web-fundamentals.jpg"></label>
    <label>Description <textarea id="ncDesc" class="btn"></textarea></label>
    <menu>
      <button class="btn" value="cancel">Close</button>
      <button id="ncSubmit" class="btn primary" value="ok">Create</button>
    </menu>
  </form>
</div></dialog>

<!-- PayPal checkout dialog -->
<dialog id="dlgPay"><div class="wrap">
  <h3 class="h3">Checkout</h3>
  <div id="ppMeta" class="small" style="margin-bottom:8px"></div>
  <div id="paypalBtns"></div>
  <menu style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
    <button class="btn" onclick="this.closest('dialog').close()">Close</button>
  </menu>
</div></dialog>

<!-- Contact dialog (form)  -->
<dialog id="dlgContact"><div class="wrap">
  <h3 class="h3">Contact us</h3>
  <form id="contactForm" style="display:grid;gap:8px">
    <input class="btn" name="from_name"  placeholder="Your name" required>
    <input class="btn" name="reply_to"   placeholder="Your email" type="email" required>
    <textarea class="btn" name="message" placeholder="Your message" required></textarea>
    <menu style="display:flex;justify-content:flex-end;gap:8px">
      <button class="btn" type="button" onclick="this.closest('dialog').close()">Close</button>
      <button class="btn primary" type="submit">Send</button>
    </menu>
  </form>
  <p class="small" id="contactHint"></p>
</div></dialog>

<script src="/firebase.js" type="module"></script>
<script src="/app.js" type="module"></script>
<script>
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw.js').catch(()=>{}); }
</script>
</body>
</html>